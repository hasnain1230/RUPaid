from src.RUPaid.Crypt import Hashing
from src.messaging.messagingController import MessagingController
from src.RUPaid.DatabaseConnection import DBConnection
from PyQt5.QtWidgets import QApplication

import sys

app = QApplication(sys.argv)
connection=DBConnection()
test_employee = [
            'Testing',
            1,
            42,
            'hasnain1230',
            'lucidity',
            'Hasnain',
            'Ali',
            'employee',
            21,
            'Software Engineer',
            'hasnain1230@gmail.com',
            '**2864',
            '8974658465'
        ]
controller = MessagingController(test_employee, connection, False)

def test_wrap_message():
    text_to_be_wrapped = "Wrap this text Wrap this text Wrap this text Wrap this text Wrap this text"
    function_wrapped = controller.wrap_text()
    manually_wrapped = ""
    for i, char in enumerate(text_to_be_wrapped):
        if(i %40 == 0):
            manually_wrapped += '\n'
        manually_wrapped += char
    assert text_to_be_wrapped == manually_wrapped

def test_get_selected_recipient():
    txt = "Hasnain, Ali - Employee"
    res = None
    if(txt.find(',') == -1):
        controller.populate_messages_list(0)
        res = 0
    tokens1 = txt.split(',')
    if(len(tokens1) < 2):
        res = None
    lastName = tokens1[0]
    tokens2 = tokens1[1].split(' ')

    firstName = tokens2[2]
    cursor = connection.get_user_id_by_name(firstName, lastName)
    selected_user_id = cursor.fetchall()[0][0]
    assert res == 42

